<div class="order-management-container">
  <!-- Background Shapes -->
  <div class="background-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header fade-in">
      <div class="header-content">
        <div class="header-icon">
          <i class="bi bi-receipt"></i>
        </div>
        <div class="header-text">
          <h1 class="page-title">Order Management</h1>
          <p class="page-subtitle">View and manage customer orders</p>
        </div>
      </div>
    </div>


    <!-- Filters & Search -->
    <div class="filters-section fade-in">
      <div class="filter-card">
        <div class="filter-header">
          <i class="bi bi-funnel"></i>
          <span>Filter by Status</span>
        </div>
        <div class="status-filters">
          <button
            class="filter-btn"
            [class.active]="selectedStatus === 'ALL'"
            (click)="filterByStatus('ALL')">
            <i class="bi bi-list-ul"></i>
            <span>All Orders</span>
            <span class="filter-count">{{ orders.length }}</span>
          </button>
          <button
            *ngFor="let status of orderStatuses"
            class="filter-btn"
            [class.active]="selectedStatus === status"
            (click)="filterByStatus(status)">
            <i class="bi"
               [class.bi-clock-history]="status === 'PENDING'"
               [class.bi-arrow-repeat]="status === 'PROCESSING'"
               [class.bi-truck]="status === 'SHIPPED'"
               [class.bi-check-circle]="status === 'DELIVERED'"
               [class.bi-x-circle]="status === 'CANCELLED'"></i>
            <span>{{ status }}</span>
            <span class="filter-count">{{ getStatusCount(status) }}</span>
          </button>
        </div>
      </div>

      <div class="search-card">
        <div class="search-wrapper">
          <i class="bi bi-search"></i>
          <input
            type="text"
            class="search-input"
            placeholder="Search by order ID or customer..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()">
        </div>
      </div>
    </div>

    <!-- Orders Table Card -->
    <div class="orders-table-card fade-in">
      <div class="table-header">
        <div class="table-title">
          <i class="bi bi-table"></i>
          <span>Orders List ({{ filteredOrders.length }})</span>
        </div>
        <div class="table-actions">
          <button class="btn-icon" title="Refresh" (click)="loadOrders()">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
          <button class="btn-icon" title="Export">
            <i class="bi bi-download"></i>
          </button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="modern-table">
          <thead>
          <tr>
            <th>Order</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let order of filteredOrders; let i = index" [style.animation-delay.ms]="i * 50">
            <td>
              <div class="order-id-cell">
                <i class="bi bi-hash"></i>
                <span>{{ order.id }}</span>
              </div>
            </td>
            <td>
              <div class="customer-cell">
                <div class="customer-avatar">
                  {{ order.user.firstName.charAt(0) }}{{ order.user.lastName.charAt(0) }}
                </div>
                <div class="customer-info">
                  <span class="customer-name">{{ order.user.firstName }} {{ order.user.lastName }}</span>
                  <span class="customer-email">{{ order.user.email }}</span>
                </div>
              </div>
            </td>
            <td>
                <span class="items-badge">
                  <i class="bi bi-bag"></i>
                  {{ order.items.length }} item{{ order.items.length !== 1 ? 's' : '' }}
                </span>
            </td>
            <td>
              <span class="price-cell">${{ order.totalAmount.toFixed(2) }}</span>
            </td>
            <td>
                <span class="status-badge"
                      [class.pending]="order.status === 'PENDING'"
                      [class.processing]="order.status === 'PROCESSING'"
                      [class.shipped]="order.status === 'SHIPPED'"
                      [class.delivered]="order.status === 'DELIVERED'"
                      [class.cancelled]="order.status === 'CANCELLED'">
                  <i class="bi"
                     [class.bi-clock-history]="order.status === 'PENDING'"
                     [class.bi-arrow-repeat]="order.status === 'PROCESSING'"
                     [class.bi-truck]="order.status === 'SHIPPED'"
                     [class.bi-check-circle]="order.status === 'DELIVERED'"
                     [class.bi-x-circle]="order.status === 'CANCELLED'"></i>
                  {{ order.status }}
                </span>
            </td>
            <td>
              <div class="date-cell">
                <i class="bi bi-calendar"></i>
                <span>{{ order.createdAt | date:'short' }}</span>
              </div>
            </td>
            <td>
              <button class="btn-action view" (click)="viewOrderDetails(order)" title="View Details">
                <i class="bi bi-eye"></i>
              </button>
            </td>
          </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <div *ngIf="filteredOrders.length === 0" class="empty-state">
          <div class="empty-icon">
            <i class="bi bi-inbox"></i>
          </div>
          <h3>No Orders Found</h3>
          <p>{{ searchTerm ? 'Try adjusting your search terms' : 'No orders match the selected filters' }}</p>
          <button class="btn btn-primary" (click)="filterByStatus('ALL'); searchTerm = ''; onSearch()">
            <i class="bi bi-arrow-clockwise"></i>
            Reset Filters
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div class="modal-overlay" *ngIf="showDetailsModal" (click)="closeDetailsModal()">
    <div class="modal-container large" (click)="$event.stopPropagation()">
      <div class="modal-card details" *ngIf="selectedOrder">
        <div class="modal-header">
          <div class="modal-title-wrapper">
            <div class="modal-icon details">
              <i class="bi bi-receipt-cutoff"></i>
            </div>
            <div>
              <h3 class="modal-title">Order Details</h3>
              <p class="modal-subtitle">Order #{{ selectedOrder.id }}</p>
            </div>
          </div>
          <button class="btn-close-modal" (click)="closeDetailsModal()">
            <i class="bi bi-x"></i>
          </button>
        </div>

        <div class="modal-body">
          <!-- Order Summary Cards -->
          <div class="order-summary-grid">
            <div class="summary-item">
              <div class="summary-icon pending">
                <i class="bi bi-receipt"></i>
              </div>
              <div class="summary-content">
                <span class="summary-label">Order ID</span>
                <span class="summary-value">#{{ selectedOrder.id }}</span>
              </div>
            </div>

            <div class="summary-item">
              <div class="summary-icon processing">
                <i class="bi bi-calendar-event"></i>
              </div>
              <div class="summary-content">
                <span class="summary-label">Order Date</span>
                <span class="summary-value">{{ selectedOrder.createdAt | date:'medium' }}</span>
              </div>
            </div>

            <div class="summary-item">
              <div class="summary-icon delivered">
                <i class="bi bi-cash-coin"></i>
              </div>
              <div class="summary-content">
                <span class="summary-label">Total Amount</span>
                <span class="summary-value">${{ selectedOrder.totalAmount.toFixed(2) }}</span>
              </div>
            </div>
          </div>

          <!-- Customer & Shipping Info -->
          <div class="info-grid">
            <div class="info-section">
              <h4 class="section-title">
                <i class="bi bi-person"></i>
                Customer Information
              </h4>
              <div class="info-content">
                <div class="customer-details">
                  <div class="customer-avatar large">
                    {{ selectedOrder.user.firstName.charAt(0) }}{{ selectedOrder.user.lastName.charAt(0) }}
                  </div>
                  <div class="customer-data">
                    <p class="customer-name">{{ selectedOrder.user.firstName }} {{ selectedOrder.user.lastName }}</p>
                    <p class="customer-email">
                      <i class="bi bi-envelope"></i>
                      {{ selectedOrder.user.email }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="info-section">
              <h4 class="section-title">
                <i class="bi bi-geo-alt"></i>
                Shipping Address
              </h4>
              <div class="info-content">
                <p class="address-text">{{ selectedOrder.shippingAddress }}</p>
              </div>
            </div>
          </div>

          <!-- Order Items -->
          <div class="items-section">
            <h4 class="section-title">
              <i class="bi bi-box-seam"></i>
              Order Items ({{ selectedOrder.items.length }})
            </h4>
            <div class="items-list">
              <div class="order-item" *ngFor="let item of selectedOrder.items">
                <img [src]="item.product.image" [alt]="item.product.name" class="item-image">
                <div class="item-details">
                  <h5 class="item-name">{{ item.product.name }}</h5>
                  <p class="item-category">
                    <i class="bi bi-tag"></i>
                    {{ item.product.category }}
                  </p>
                </div>
                <div class="item-pricing">
                  <div class="price-row">
                    <span class="price-label">Price:</span>
                    <span class="price-value">${{ item.product.price.toFixed(2) }}</span>
                  </div>
                  <div class="price-row">
                    <span class="price-label">Qty:</span>
                    <span class="price-value">{{ item.quantity }}</span>
                  </div>
                  <div class="price-row total">
                    <span class="price-label">Subtotal:</span>
                    <span class="price-value">${{ (item.product.price * item.quantity).toFixed(2) }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Total -->
            <div class="order-total">
              <span class="total-label">Order Total</span>
              <span class="total-value">${{ selectedOrder.totalAmount.toFixed(2) }}</span>
            </div>
          </div>

          <!-- Status Management -->
          <div class="status-section">
            <h4 class="section-title">
              <i class="bi bi-arrow-repeat"></i>
              Update Order Status
            </h4>
            <div class="status-buttons">
              <button
                *ngFor="let status of orderStatuses"
                class="status-btn"
                [class.active]="selectedOrder.status === status"
                [class.pending]="status === 'PENDING'"
                [class.processing]="status === 'PROCESSING'"
                [class.shipped]="status === 'SHIPPED'"
                [class.delivered]="status === 'DELIVERED'"
                [class.cancelled]="status === 'CANCELLED'"
                [disabled]="selectedOrder.status === status"
                (click)="updateOrderStatus(selectedOrder.id, status)">
                <i class="bi"
                   [class.bi-clock-history]="status === 'PENDING'"
                   [class.bi-arrow-repeat]="status === 'PROCESSING'"
                   [class.bi-truck]="status === 'SHIPPED'"
                   [class.bi-check-circle]="status === 'DELIVERED'"
                   [class.bi-x-circle]="status === 'CANCELLED'"></i>
                {{ status }}
              </button>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" (click)="closeDetailsModal()">
            <i class="bi bi-x-circle"></i>
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
